<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8"/>
    <title>OneBite 간편 로그인</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="/css/login.css"/>
</head>
<body>
<main class="card">

    <!-- 큰 로고 -->
    <img src="/img/225098696.png" alt="앱 로고" class="hero-logo"/>

    <div class="app-title">OneBite 간편 로그인</div>

    <!-- 로그인 상태 표시 -->
    <div class="status" sec:authorize="isAuthenticated()">
        <span class="pill">SIGNED IN</span>
        <span th:text="${#authentication?.name}">user</span>님으로 로그인되었습니다.
    </div>

    <!-- 로그아웃 + 계정 바꾸기 -->
    <form sec:authorize="isAuthenticated()" method="post" action="/logout" style="margin-top:10px">
        <button class="logout" type="submit">로그아웃</button>
        <a class="switch" href="/login?switch">계정 바꾸기</a>
    </form>

    <!-- 로그인 버튼들 -->
    <!-- 1) 비로그인 상태에서 항상 노출 -->
    <div class="row" sec:authorize="isAnonymous()">
        <a class="btn google" href="/oauth2/authorization/google" aria-label="Google 로그인">
            <img class="icon" src="/img/google.png" alt=""/> <span><strong>Google</strong>로 계속하기</span>
        </a>
        <a class="btn kakao" href="/oauth2/authorization/kakao" aria-label="Kakao 로그인">
            <img class="icon" src="/img/kakao.png" alt=""/> <span><strong>Kakao</strong>로 계속하기</span>
        </a>
        <a class="btn naver" href="/oauth2/authorization/naver" aria-label="Naver 로그인">
            <img class="icon" src="/img/naver.png" alt=""/> <span><strong>Naver</strong>로 계속하기</span>
        </a>
    </div>

    <!-- 2) 로그인된 상태에선 '계정 바꾸기' 모드에서만 버튼 노출 -->
    <div class="row" sec:authorize="isAuthenticated()" th:if="${param.switch != null}">
        <a class="btn google" href="/oauth2/authorization/google" aria-label="Google 로그인">
            <img class="icon" src="/img/google.png" alt=""/> <span><strong>Google</strong>로 계속하기</span>
        </a>
        <a class="btn kakao" href="/oauth2/authorization/kakao" aria-label="Kakao 로그인">
            <img class="icon" src="/img/kakao.png" alt=""/> <span><strong>Kakao</strong>로 계속하기</span>
        </a>
        <a class="btn naver" href="/oauth2/authorization/naver" aria-label="Naver 로그인">
            <img class="icon" src="/img/naver.png" alt=""/> <span><strong>Naver</strong>로 계속하기</span>
        </a>
    </div>

    <!-- 3) 로그인된 상태 + switch 모드 아님 → 안내만 -->
    <div class="row" sec:authorize="isAuthenticated()" th:if="${param.switch == null}">
        <div class="hint">이미 로그인되어 있습니다. 다른 계정으로 로그인하려면 <b>계정 바꾸기</b>를 누르세요.</div>
        <div class="footer">
            로그인 완료 <a href="/profile">프로필 JSON 보기</a>
        </div>
    </div>

    <hr class="hr"/>

    <!-- 에러 메시지 -->
    <div class="status" th:if="${param.error}">
        로그인 중 문제가 발생했습니다. 다시 시도해주세요.
        (<span th:text="${param.error}">error</span>)
    </div>

</main>
</body>
</html>
