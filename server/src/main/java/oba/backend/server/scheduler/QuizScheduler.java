package scheduler;

import lombok.RequiredArgsConstructor;
import oba.backend.server.service.QuizPipelineService;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

/**
 * âœ… QuizScheduler
 * - ë§¤ì¼ ì¼ì • ì‹œê°„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” "ìŠ¤ì¼€ì¤„ë§(Spring Scheduler)" í´ë˜ìŠ¤
 * - ëª©ì : ë§¤ì¼ ì˜¤ì „ 9ì‹œì— FastAPIë¥¼ í˜¸ì¶œí•´ ìƒˆ ë‰´ìŠ¤ ê¸°ë°˜ í€´ì¦ˆë¥¼ ìë™ ìƒì„±
 */
@Component // âœ… ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” Bean ë“±ë¡ (ìŠ¤ì¼€ì¤„ëŸ¬ ìë™ ê°ì§€ ëŒ€ìƒ)
@RequiredArgsConstructor // âœ… final í•„ë“œ ìë™ ìƒì„±ì ì£¼ì… (DI)
public class QuizScheduler {

    // âœ… í€´ì¦ˆ ìë™ ìƒì„± íŒŒì´í”„ë¼ì¸ ì„œë¹„ìŠ¤
    // - FastAPI í˜¸ì¶œ + GPT ì‘ë‹µ + MySQL ì €ì¥ ë¡œì§ì„ ë‹´ë‹¹
    private final QuizPipelineService quizPipelineService;

    /**
     * ğŸ•˜ ë§¤ì¼ ì˜¤ì „ 9ì‹œ(ì„œìš¸ ê¸°ì¤€)ì— ìë™ ì‹¤í–‰
     * - @Scheduled(cron = "0 0 9 * * *") ì€ cron í‘œí˜„ì‹ ê¸°ë°˜ ìŠ¤ì¼€ì¤„ ì„¤ì •
     * - zone = "Asia/Seoul" â†’ í•œêµ­ ì‹œê°„ ê¸°ì¤€
     *
     * ë™ì‘ ìˆœì„œ:
     *  1ï¸âƒ£ ì˜¤ì „ 9ì‹œê°€ ë˜ë©´ Springì´ ìë™ìœ¼ë¡œ ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œ
     *  2ï¸âƒ£ QuizPipelineService.generateQuizzesFromSelectedArticles() ì‹¤í–‰
     *  3ï¸âƒ£ FastAPIë¡œ URL ì „ì†¡ â†’ GPT ë¶„ì„ â†’ í€´ì¦ˆ ìƒì„± â†’ MySQL ì €ì¥
     *  4ï¸âƒ£ ì½˜ì†” ë¡œê·¸ë¡œ ì‹œì‘/ì™„ë£Œ ë©”ì‹œì§€ ì¶œë ¥
     */
    @Scheduled(cron = "0 0 9 * * *", zone = "Asia/Seoul")
    public void autoGenerateDailyQuizzes() {
        System.out.println("ğŸš€ [ìŠ¤ì¼€ì¤„ëŸ¬] ì˜¤ëŠ˜ ê¸°ì‚¬ ê¸°ë°˜ ìë™ í€´ì¦ˆ ìƒì„± ì‹œì‘");

        // âœ… ì‹¤ì œ í€´ì¦ˆ ìƒì„± íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
        quizPipelineService.generateQuizzesFromSelectedArticles();

        System.out.println("âœ… ìë™ í€´ì¦ˆ ìƒì„± ì™„ë£Œ");
    }
}
